<section id="dashboard" class="section section--hero">
  <div class="hero-card">
    <div class="hero-card__intro">
      <p class="hero-card__eyebrow"><%= summary.greeting %></p>
      <h2 class="hero-card__headline"><%= summary.headline %></h2>
      <p class="hero-card__body"><%= summary.subheadline %></p>
      <div class="hero-card__meta">
        <span title="<%= summary.refreshExact %>"
          >Updated <%= summary.refreshRelative %></span
        >
        <span>Active leads: <strong><%= summary.activeLeadTally %></strong></span>
        <span>Booked jobs: <strong><%= summary.bookedJobTally %></strong></span>
      </div>
    </div>
    <div class="hero-card__stats">
      <div class="hero-card__stat">
        <span class="hero-card__stat-label">Leads in pipeline</span>
        <span class="hero-card__stat-value"
          ><%= summary.totalLeadTally.toLocaleString('en-US') %></span
        >
        <span class="hero-card__stat-footnote"
          ><%= summary.newLeadsToday %> new today</span
        >
      </div>
      <div class="hero-card__stat hero-card__stat--accent">
        <span class="hero-card__stat-label">Conversion rate</span>
        <span class="hero-card__stat-value"><%= summary.conversionRate %></span>
        <span class="hero-card__stat-footnote"
          >Avg quote <%= summary.averageQuoteValue %></span
        >
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="section__header">
    <h3 class="section__title">Executive Metrics</h3>
    <p class="section__subtitle">
      Live overview of your booking health, approvals, and revenue signals.
    </p>
  </div>
  <div class="metrics-grid">
    <% metricsCards.forEach(function (card) { %>
    <article class="metric-card metric-card--<%= card.key %>">
      <div class="metric-card__icon"></div>
      <div class="metric-card__labels">
        <span class="metric-card__label"><%= card.label %></span>
        <% if (card.hint) { %>
        <span class="metric-card__hint"><%= card.hint %></span>
        <% } %>
      </div>
      <div class="metric-card__value"><%= card.value %></div>
      <% if (card.deltaLabel) { %>
      <div
        class="metric-card__delta metric-card__delta--<%= card.deltaTone || 'neutral' %>"
      >
        <span class="metric-card__delta-indicator"></span>
        <span><%= card.deltaLabel %></span>
      </div>
      <% } %>
    </article>
    <% }) %>
  </div>
</section>

<section id="pipeline" class="section">
  <div class="section__header">
    <h3 class="section__title">Pipeline Focus</h3>
    <p class="section__subtitle">
      Track where customers sit in the JunkQuote workflow and unblock stalled
      conversations.
    </p>
  </div>
  <div class="stage-grid">
    <% stageBreakdown.forEach(function (stage) { %>
    <div class="stage-card stage-card--<%= stage.tone %>">
      <header class="stage-card__header">
        <div>
          <span class="stage-card__label"><%= stage.label %></span>
          <p class="stage-card__caption"><%= stage.caption %></p>
        </div>
        <span class="stage-card__count"><%= stage.count %></span>
      </header>
      <div class="stage-card__progress">
        <div
          class="stage-card__progress-fill"
          style="width: <%= stage.percent %>%;"
        ></div>
      </div>
      <footer class="stage-card__footer">
        <span><%= stage.percent.toFixed(0) %>% of pipeline</span>
        <% if (stage.trendLabel) { %>
        <span class="stage-card__trend"><%= stage.trendLabel %></span>
        <% } %>
      </footer>
    </div>
    <% }) %>
  </div>
</section>

<section id="approvals" class="section">
  <div class="section__header">
    <h3 class="section__title">Approvals Queue</h3>
    <p class="section__subtitle">
      Quotes above your automation threshold that need an owner decision.
    </p>
  </div>
  <div class="card table-card">
    <table class="data-table">
      <thead>
        <tr>
          <th scope="col">Quote</th>
          <th scope="col">Lead</th>
          <th scope="col">Total</th>
          <th scope="col">Flags</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        <% if (approvalsQueue.length === 0) { %>
        <tr>
          <td colspan="5" class="data-table__empty">
            All caught up. Approvals will land here when needed.
          </td>
        </tr>
        <% } else { %> <% approvalsQueue.forEach(function (approval) { %>
        <tr class="data-table__row data-table__row--<%= approval.riskLevel %>">
          <td>
            <div class="table-primary">
              <div class="table-primary__title"><%= approval.quoteId %></div>
              <div class="table-primary__meta">
                Submitted <%= approval.submittedAgo %>
              </div>
            </div>
          </td>
          <td>
            <div class="table-stack">
              <span class="table-stack__title"><%= approval.leadName %></span>
              <span class="table-stack__meta"
                ><%= approval.address || 'Address pending' %></span
              >
            </div>
          </td>
          <td>
            <div class="table-value">
              <span class="table-value__primary"><%= approval.totalDisplay %></span>
              <span class="table-value__meta"><%= approval.confidenceCopy %></span>
            </div>
          </td>
          <td>
            <div class="pill-row">
              <% if (approval.flags.length === 0) { %>
              <span class="pill pill--neutral">No flags</span>
              <% } else { %> <% approval.flags.forEach(function (flag) { %>
              <span class="pill pill--warning"><%= flag %></span>
              <% }); %> <% } %>
            </div>
          </td>
          <td>
            <div class="table-actions">
              <a
                class="button button--small button--success"
                href="/api/approve/<%= approval.token %>?decision=approve"
                >Approve</a
              >
              <a
                class="button button--small button--danger"
                href="/api/approve/<%= approval.token %>?decision=deny"
                >Decline</a
              >
            </div>
          </td>
        </tr>
        <% }); %> <% } %>
      </tbody>
    </table>
  </div>
</section>

<section class="section">
  <div class="section__header">
    <h3 class="section__title">Lead Pipeline</h3>
    <p class="section__subtitle">
      The ten most recent conversations with stage, quote, and photo context.
    </p>
  </div>
  <div class="card table-card">
    <table class="data-table data-table--leads">
      <thead>
        <tr>
          <th scope="col">Lead</th>
          <th scope="col">Stage</th>
          <th scope="col">Quote</th>
          <th scope="col">Photos</th>
          <th scope="col">Next Step</th>
        </tr>
      </thead>
      <tbody>
        <% if (pipelineRows.length === 0) { %>
        <tr>
          <td colspan="5" class="data-table__empty">
            No leads yet - connect Messenger to start capturing junk removal
            requests.
          </td>
        </tr>
        <% } else { %> <% pipelineRows.forEach(function (lead) { %>
        <tr>
          <td>
            <div class="table-stack">
              <span class="table-stack__title"><%= lead.displayName %></span>
              <span class="table-stack__meta"
                ><%= lead.channelLabel %> | Updated <%= lead.updatedAgo %></span
              >
              <span class="table-stack__meta"
                ><%= lead.address || 'Address pending' %></span
              >
            </div>
          </td>
          <td>
            <span class="status-badge status-badge--<%= lead.stageClass %>"
              ><%= lead.stageLabel %></span
            >
          </td>
          <td>
            <% if (lead.quoteSummary) { %>
            <div class="table-value">
              <span class="table-value__primary"
                ><%= lead.quoteSummary.totalDisplay %></span
              >
              <span class="table-value__meta"
                ><%= lead.quoteSummary.statusLabel %> | Confidence
                <%= lead.quoteSummary.confidence %></span
              >
              <% if (lead.quoteSummary.needsApproval) { %>
              <span class="pill pill--warning">Needs approval</span>
              <% } %>
            </div>
            <% } else { %>
            <span class="pill pill--neutral">No quote yet</span>
            <% } %>
          </td>
          <td>
            <div class="photo-group">
              <% if (lead.attachments.length === 0) { %>
              <span class="pill pill--neutral">Awaiting photos</span>
              <% } else { %> <% lead.attachments.forEach(function (url) { %>
              <img
                class="photo-group__item"
                src="<%= url %>"
                alt="Lead attachment"
                loading="lazy"
              />
              <% }); %> <% } %>
            </div>
          </td>
          <td>
            <div class="table-stack">
              <span class="table-stack__title"><%= lead.nextAction %></span>
              <span class="table-stack__meta"><%= lead.contactSummary %></span>
            </div>
          </td>
        </tr>
        <% }); %> <% } %>
      </tbody>
    </table>
  </div>
</section>

<section id="jobs" class="section">
  <div class="section__header">
    <h3 class="section__title">Upcoming Jobs</h3>
    <p class="section__subtitle">
      Confirmed and tentative pickups across the next seven days.
    </p>
  </div>
  <div class="timeline">
    <% if (upcomingJobs.length === 0) { %>
    <div class="timeline__empty">
      Nothing scheduled yet. Confirm a quote to create the first pickup window.
    </div>
    <% } else { %> <% upcomingJobs.forEach(function (job) { %>
    <article class="timeline__item timeline__item--<%= job.statusClass %>">
      <div class="timeline__timestamp">
        <span class="timeline__date"><%= job.windowLabel %></span>
        <span class="timeline__meta"><%= job.windowRelative %></span>
      </div>
      <div class="timeline__body">
        <h4 class="timeline__title"><%= job.leadName %></h4>
        <p class="timeline__subtitle">
          <%= job.address || 'Address pending confirmation' %>
        </p>
        <div class="timeline__tags">
          <span class="pill pill--status pill--status-<%= job.statusClass %>"
            ><%= job.statusLabel %></span
          >
          <span class="pill pill--info"><%= job.reminderStatus %></span>
        </div>
      </div>
    </article>
    <% }); %> <% } %>
  </div>
</section>

<section id="activity" class="section section--split">
  <div class="section__split-panel">
    <header class="section__header">
      <h3 class="section__title">Recent Activity</h3>
      <p class="section__subtitle">
        Audit trail across agent actions, approvals, and customer updates.
      </p>
    </header>
    <div class="feed">
      <% if (activityFeed.length === 0) { %>
      <div class="feed__empty">
        Once customers engage, the running log of automation decisions will
        populate here.
      </div>
      <% } else { %> <% activityFeed.forEach(function (entry) { %>
      <article class="feed__item feed__item--<%= entry.badgeTone %>">
        <div class="feed__timestamp" title="<%= entry.timestamp %>">
          <%= entry.timeAgo %>
        </div>
        <div class="feed__content">
          <div class="feed__title"><%= entry.actionLabel %></div>
          <div class="feed__meta">
            <span><%= entry.actor %></span>
            <% if (entry.summary) { %>
            <span>| <%= entry.summary %></span>
            <% } %>
          </div>
          <% if (entry.payloadSnippet) { %>
          <pre class="feed__payload"><%= entry.payloadSnippet %></pre>
          <% } %>
        </div>
      </article>
      <% }); %> <% } %>
    </div>
  </div>
  <div class="section__split-panel">
    <header class="section__header">
      <h3 class="section__title">Photo Gallery</h3>
      <p class="section__subtitle">
        Visual context from the most recent customer submissions.
      </p>
    </header>
    <div class="gallery">
      <% if (photoGallery.length === 0) { %>
      <div class="gallery__empty">
        Remind customers to upload at least one photo for faster quoting.
      </div>
      <% } else { %> <% photoGallery.forEach(function (item) { %>
      <figure class="gallery__item">
        <img
          src="<%= item.url %>"
          alt="Customer submitted photo"
          loading="lazy"
        />
        <figcaption>
          <strong><%= item.leadName %></strong>
          <span><%= item.stageLabel %></span>
          <span><%= item.capturedAgo %></span>
        </figcaption>
      </figure>
      <% }); %> <% } %>
    </div>
  </div>
</section>
