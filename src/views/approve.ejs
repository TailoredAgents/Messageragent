<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Quote Approval</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 2rem;
        background-color: #fafafa;
        color: #222;
      }
      .card {
        background: #fff;
        border: 1px solid #ddd;
        padding: 1.5rem;
        max-width: 600px;
      }
      h1 {
        margin-top: 0;
      }
      a.button {
        display: inline-block;
        margin-right: 1rem;
        padding: 0.5rem 1.25rem;
        background-color: #2563eb;
        color: #fff;
        text-decoration: none;
        border-radius: 4px;
      }
      a.button.deny {
        background-color: #dc2626;
      }
      .muted {
        color: #666;
      }
      ul {
        padding-left: 1.5rem;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <% if (message) { %>
      <p><strong><%= message %></strong></p>
      <% } %>
      <h1>Quote <%= approval.quoteId %></h1>
      <p>
        Lead:
        <strong><%= approval.quote.lead.name || 'Messenger lead' %></strong><br />
        <span class="muted"><%= approval.quote.lead.address || 'Address pending' %></span>
      </p>
      <p>Total: $<%= approval.quote.total.toFixed(2) %></p>
      <p>Flags: <code><%= JSON.stringify(approval.quote.flagsJson || {}) %></code></p>
      <h2>Line items</h2>
      <ul>
        <% (approval.quote.lineItemsJson || []).forEach(function (item) { %>
        <li><%= item.label %> — $<%= item.amount.toFixed(2) %></li>
        <% }) %>
      </ul>
      <% if ((approval.quote.discountsJson || []).length > 0) { %>
      <h3>Discounts</h3>
      <ul>
        <% approval.quote.discountsJson.forEach(function (item) { %>
        <li><%= item.label %> — $<%= item.amount.toFixed(2) %></li>
        <% }) %>
      </ul>
      <% } %>
      <% if (approval.status === 'pending') { %>
      <p>
        <a class="button" href="/api/approve/<%= approval.token %>?decision=approve">Approve</a>
        <a class="button deny" href="/api/approve/<%= approval.token %>?decision=deny">Deny</a>
      </p>
      <% } else { %>
      <p>Status: <strong><%= approval.status %></strong></p>
      <% } %>
    </div>
  </body>
</html>
